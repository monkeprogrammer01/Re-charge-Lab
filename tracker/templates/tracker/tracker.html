{% extends 'main/base.html' %}

    {% block extra_css %}
    <style>

        .container {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }

        {#/* Header */#}
        .header {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }

        .date {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .balance-score {
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0;
        }

        .progress-bar {
            height: 12px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .balance-status {
            font-size: 14px;
            color: #666;
        }

        /* Tracker Sections */
        .section {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 600;
        }

        .section-header .icon {
            font-size: 24px;
            margin-right: 10px;
        }

        .section-progress {
            height: 6px;
            background: #f0f0f0;
            border-radius: 3px;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .section-progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        /* Physical - Green */
        .physical .section-progress-fill { background: #4CAF50; }

        /* Emotional - Orange */
        .emotional .section-progress-fill { background: #FF9800; }

        /* Social - Blue */
        .social .section-progress-fill { background: #2196F3; }

        /* Trackers */
        .tracker-grid {
            display: grid;
            gap: 15px;
        }

        .tracker-item {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
        }

        .tracker-title {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            font-size: 14px;
            font-weight: 500;
        }

        .tracker-title .emoji {
            font-size: 20px;
            margin-right: 8px;
        }

        /* Meals Tracker */
        .meals-container {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }

        .meal {
            flex: 1;
            text-align: center;
            padding: 10px;
            background: #e8f5e8;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .meal.eaten {
            background: #4CAF50;
            color: white;
            border-color: #45a049;
        }

        .meal-time {
            font-size: 12px;
            margin-top: 5px;
            opacity: 0.7;
        }

        /* Water Tracker */
        .water-container {
            display: flex;
            justify-content: space-between;
            gap: 5px;
        }

        .glass {
            flex: 1;
            text-align: center;
            padding: 8px 5px;
            background: #e3f2fd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .glass.filled {
            background: #2196F3;
            color: white;
            border-color: #1976D2;
        }

        /* Movement Tracker */
        .movement-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .time-display {
            font-size: 18px;
            font-weight: bold;
            min-width: 60px;
            text-align: center;
        }

        .time-btn {
            padding: 8px 12px;
            background: #FF9800;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }

        /* Stimulants Tracker */
        .stimulants-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .stimulant-item {
            text-align: center;
        }

        .stimulant-buttons {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }

        .stimulant-btn {
            flex: 1;
            padding: 5px;
            background: #ffebee;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .stimulant-btn.active {
            background: #f44336;
            color: white;
        }

        /* Mood Tracker */
        .mood-container {
            display: flex;
            justify-content: space-between;
            gap: 5px;
        }

        .mood-option {
            flex: 1;
            text-align: center;
            padding: 10px;
            background: #fff3e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .mood-option.selected {
            background: #FF9800;
            color: white;
            border-color: #F57C00;
        }

        /* Relaxation Tracker */
        .relaxation-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Challenge Tracker */
        .challenge-card {
            background: #e8f5e8;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }

        .challenge-text {
            font-size: 14px;
            margin-bottom: 10px;
        }

        .challenge-btn {
            padding: 8px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        /* Social Tracker */
        .social-checkboxes {
            display: grid;
            gap: 10px;
        }

        .social-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 10px;
            cursor: pointer;
        }

        /* Progress Section */
        .achievements {
            display: grid;
            gap: 10px;
        }

        .achievement {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        /* Notifications */
        .notifications {
            text-align: center;
            padding: 15px;
            background: #e8f5e8;
            border-radius: 12px;
            margin-top: 10px;
        }

        /* Responsive */
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }

            .section {
                padding: 15px;
            }

            .meals-container,
            .water-container {
                gap: 5px;
            }
        }
    </style>
    {% endblock %}
{% block content %}


    <div class="container" >

        <div class="header">
            <div class="date" id="current-date">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 15 –¥–µ–∫–∞–±—Ä—è</div>
            <div class="balance-score" id="balance-score">{{ total_points }}</div>
            <div class="progress-bar">
                <div class="progress-fill" id="main-progress" style="width: {{ total_points }}"></div>
            </div>
            <div class="balance-status" id="balance-status">üü° –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –±–∞–ª–∞–Ω—Å–∞</div>
        </div>

        <div class="section physical">
            <div class="section-header">
                <span class="icon">üçé</span>
                –§–ò–ó–ò–ß–ï–°–ö–û–ï –ó–î–û–†–û–í–¨–ï
            </div>
            <div class="section-progress">
                <div class="section-progress-fill" style="width: 80%"></div>
            </div>

            <div class="tracker-grid">
                <div class="tracker-item">
                    <div class="tracker-title">
                        <span class="emoji">üçΩÔ∏è</span>
                        –ü–ò–¢–ê–ù–ò–ï
                    </div>
                    <div class="meals-container">
                        <div class="meal" data-meal="breakfast">
                            <div>üç≥</div>
                            <div class="meal-time">–ó–∞–≤—Ç—Ä–∞–∫</div>
                        </div>
                        <div class="meal" data-meal="lunch">
                            <div>üç≤</div>
                            <div class="meal-time">–û–±–µ–¥</div>
                        </div>
                        <div class="meal" data-meal="dinner">
                            <div>üçù</div>
                            <div class="meal-time">–£–∂–∏–Ω</div>
                        </div>
                    </div>
                </div>

                <!-- Water -->
                <div class="tracker-item">
                    <div class="tracker-title">
                        <span class="emoji">üíß</span>
                        –í–û–î–ê ({{ water }}/8)
                    </div>
                    <div class="water-container">
                        <div class="glass">üíß</div>
                        <div class="glass">üíß</div>
                        <div class="glass">üíß</div>
                        <div class="glass">üíß</div>
                        <div class="glass">üíß</div>
                        <div class="glass">üíß</div>
                        <div class="glass">üíß</div>
                        <div class="glass">üíß</div>
                        <div class="glass">üíß</div>
                        <div class="glass">üíß</div>

                    </div>
                </div>

                <!-- Movement -->
                <div class="tracker-item">
                    <div class="tracker-title">
                        <span class="emoji">üö∂</span>
                        –î–í–ò–ñ–ï–ù–ò–ï
                    </div>
                    <div class="movement-controls">
                        <button class="time-btn" onclick="updateMovement(-5)">-5</button>
                        <div class="time-display" id="movement-time">25 –º–∏–Ω</div>
                        <button class="time-btn" onclick="updateMovement(5)">+5</button>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="went-outside">
                        <label for="went-outside">üö∂ –í—ã—à–µ–ª –Ω–∞ —É–ª–∏—Ü—É</label>
                    </div>
                </div>

                <!-- Stimulants -->
                <div class="tracker-item">
                    <div class="tracker-title">
                        <span class="emoji">‚ö°</span>
                        –°–¢–ò–ú–£–õ–Ø–¢–û–†–´
                    </div>
                    <div class="stimulants-grid">
                        <div class="stimulant-item">
                            <div>‚òï –ö–æ—Ñ–µ</div>
                            <div class="stimulant-buttons">
                                <button class="stimulant-btn active">1</button>
                                <button class="stimulant-btn">2</button>
                                <button class="stimulant-btn">3</button>
                            </div>
                        </div>
                        <div class="stimulant-item">
                            <div>üç© –°–ª–∞–¥–∫–æ–µ</div>
                            <div class="stimulant-buttons">
                                <button class="stimulant-btn">1</button>
                                <button class="stimulant-btn">2</button>
                                <button class="stimulant-btn">3</button>
                                <button class="stimulant-btn">4</button>
                                <button class="stimulant-btn">5</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Emotional Health Section -->
        <div class="section emotional">
            <div class="section-header">
                <span class="icon">üíñ</span>
                –≠–ú–û–¶–ò–û–ù–ê–õ–¨–ù–û–ï –°–û–°–¢–û–Ø–ù–ò–ï
            </div>
            <div class="section-progress">
                <div class="section-progress-fill" style="width: 50%"></div>
            </div>

            <div class="tracker-grid">
                <!-- Mood -->
                <div class="tracker-item">
                    <div class="tracker-title">
                        <span class="emoji">üòä</span>
                        –ù–ê–°–¢–†–û–ï–ù–ò–ï
                    </div>
                    <div class="mood-container">
                        <div class="mood-option selected" data-mood="3">
                            <div>üòä</div>
                            <div>–•–æ—Ä–æ—à–æ</div>
                        </div>
                        <div class="mood-option" data-mood="2">
                            <div>üòê</div>
                            <div>–ù–æ—Ä–º–∞–ª—å–Ω–æ</div>
                        </div>
                        <div class="mood-option" data-mood="1">
                            <div>üò¢</div>
                            <div>–ü–ª–æ—Ö–æ</div>
                        </div>
                    </div>
                </div>

                <!-- Relaxation -->
                <div class="tracker-item">
                    <div class="tracker-title">
                        <span class="emoji">üßò</span>
                        –†–ï–õ–ê–ö–° (10/30 –º–∏–Ω)
                    </div>
                    <div class="relaxation-controls">
                        <button class="time-btn" onclick="updateRelaxation(-5)">-5</button>
                        <div class="time-display" id="relaxation-time">10 –º–∏–Ω</div>
                        <button class="time-btn" onclick="updateRelaxation(5)">+5</button>
                    </div>
                </div>

                <!-- Daily Challenge -->
                <div class="tracker-item">
                    <div class="tracker-title">
                        <span class="emoji">üéØ</span>
                        –ß–ï–õ–õ–ï–ù–î–ñ –î–ù–Ø
                    </div>
                    <div class="challenge-card">
                        <div class="challenge-text">"–°–¥–µ–ª–∞–π 5 –≥–ª—É–±–æ–∫–∏—Ö –≤–¥–æ—Ö–æ–≤"</div>
                        <button class="challenge-btn" onclick="completeChallenge()">‚úÖ –í–´–ü–û–õ–ù–ò–õ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Social Connections Section -->
        <div class="section social">
            <div class="section-header">
                <span class="icon">üë•</span>
                –°–û–¶–ò–ê–õ–¨–ù–´–ï –°–í–Ø–ó–ò
            </div>
            <div class="section-progress">
                <div class="section-progress-fill" style="width: 20%"></div>
            </div>

            <div class="tracker-grid">
                <div class="social-checkboxes">
                    <div class="social-checkbox">
                        <input type="checkbox" id="social-chat">
                        <label for="social-chat">üí¨ –ù–∞–ø–∏—Å–∞–ª –¥—Ä—É–≥—É</label>
                    </div>
                    <div class="social-checkbox">
                        <input type="checkbox" id="social-call">
                        <label for="social-call">üìû –ü–æ–∑–≤–æ–Ω–∏–ª –±–ª–∏–∑–∫–∏–º</label>
                    </div>
                    <div class="social-checkbox">
                        <input type="checkbox" id="social-colleague">
                        <label for="social-colleague">üë• –ü–æ–æ–±—â–∞–ª—Å—è —Å –∫–æ–ª–ª–µ–≥–æ–π</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress & Notifications -->
        <div class="section">
            <div class="section-header">
                <span class="icon">üìä</span>
                –ü–†–û–ì–†–ï–°–° –î–ù–Ø
            </div>

            <div class="achievements">
                <div class="achievement">
                    <span>üíß</span>
                    <span>–í—ã–ø–∏–ª 4 —Å—Ç–∞–∫–∞–Ω–∞ –≤–æ–¥—ã</span>
                </div>
                <div class="achievement">
                    <span>üç≥</span>
                    <span>–ü–æ–∑–∞–≤—Ç—Ä–∞–∫–∞–ª –∏ –ø–æ–æ–±–µ–¥–∞–ª</span>
                </div>
                <div class="achievement">
                    <span>üö∂</span>
                    <span>25 –º–∏–Ω—É—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</span>
                </div>
            </div>

            <div class="notifications">
                <div>üîî TELEGRAM: ‚úÖ –ü—Ä–∏–≤—è–∑–∞–Ω</div>
                <div style="font-size: 12px; margin-top: 5px; opacity: 0.7;">–ü–æ–ª—É—á–∞–µ—à—å —É–º–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</div>
            </div>
        </div>
    </div>
{% endblock %}
{% block extra_js %}
    <script>
        // Initialize current date
        const csrftoken = document.querySelector('[name=csrf-token]').content;

        const now = new Date();
        const options = { weekday: 'long', day: 'numeric', month: 'long' };
        document.getElementById('current-date').textContent = now.toLocaleDateString('ru-RU', options);
        function getMealsState() {
            const meals = {};

            document.querySelectorAll('.meal').forEach(meal => {
                const name = meal.dataset.meal;
                meals[name] = meal.classList.contains('eaten')
            })
            return meals;
        }
        // Meal tracker
        document.querySelectorAll('.meal').forEach(meal => {
            meal.addEventListener('click', function() {
                this.classList.toggle('eaten');
                const mealsState = getMealsState();

                fetch("/tracker/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-CSRFToken": csrftoken
                    },
                    body: JSON.stringify({field: "meals", value: mealsState})
                })
                    .then(response => response.json())
                    .then(data => {
                        updateBalance(data.total_points)
                    })
                    .catch(err => console.error(err))
            });
        });

document.querySelectorAll('.glass').forEach((glass, index) => {
    glass.addEventListener('click', function() {
        const glasses = document.querySelectorAll('.glass');
        const currentIndex = Array.from(glasses).indexOf(this);

        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–ª–∞—Å—Å—ã
        glasses.forEach((g, i) => {
            if (i <= currentIndex) {
                g.classList.add('filled');
            } else {
                g.classList.remove('filled');
            }
        });

        // –°—á–∏—Ç–∞–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        const filledCount = document.querySelectorAll('.glass.filled').length;

        // –û–¥–∏–Ω POST-–∑–∞–ø—Ä–æ—Å
        fetch("/tracker/", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": csrftoken
            },
            body: JSON.stringify({field: "water", value: filledCount})
        })
        .then(response => response.json())
        .then(data => {
            updateBalance(data.total_points);

        })
        .catch(err => console.error(err));
    });
});


        document.querySelectorAll('.mood-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.mood-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                this.classList.add('selected');
                updateBalance();
            });
        });

        document.querySelectorAll('.stimulant-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const buttons = this.parentElement.querySelectorAll('.stimulant-btn');
                const clickedIndex = Array.from(buttons).indexOf(this);

                buttons.forEach((button, index) => {
                    if (index <= clickedIndex) {
                        button.classList.add('active');
                    } else {
                        button.classList.remove('active');
                    }
                });

                updateBalance();
            });
        });

        function updateMovement(minutes) {
            const timeDisplay = document.getElementById('movement-time');
            let currentTime = parseInt(timeDisplay.textContent);
            currentTime = Math.max(0, currentTime + minutes);
            timeDisplay.textContent = currentTime + ' –º–∏–Ω';
            const point = currentTime / 30

            updateBalance(point);
        }

        function updateRelaxation(minutes) {
            const timeDisplay = document.getElementById('relaxation-time');
            let currentTime = parseInt(timeDisplay.textContent);
            currentTime = Math.max(0, currentTime + minutes);
            timeDisplay.textContent = currentTime + ' –º–∏–Ω';
            const point = currentTime * 100 / 30
            updateBalance(point);
        }

        function completeChallenge() {
            alert('üéâ –û—Ç–ª–∏—á–Ω–æ! –ß–µ–ª–ª–µ–Ω–¥–∂ –≤—ã–ø–æ–ª–Ω–µ–Ω!');
            updateBalance(20);
        }

        // Update overall balance (simplified)
        function updateBalance(earned) {
            // In real app, this would calculate based on all trackers
            const currentBalance = parseInt(document.getElementById('balance-score').textContent);
            const newBalance = Math.max(0, Math.min(100, currentBalance + earned));

            document.getElementById('balance-score').textContent = Math.round(newBalance) + '%';
            document.getElementById('main-progress').style.width = newBalance + '%';

            // Update status
            const statusElement = document.getElementById('balance-status');
            if (newBalance >= 70) {
                statusElement.textContent = 'üü¢ –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –±–∞–ª–∞–Ω—Å–∞';
            } else if (newBalance >= 40) {
                statusElement.textContent = 'üü° –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –±–∞–ª–∞–Ω—Å–∞';
            } else {
                statusElement.textContent = 'üî¥ –ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –±–∞–ª–∞–Ω—Å–∞';
            }
        }

        // Social checkboxes
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', updateBalance);
        });
    </script>
{% endblock %}