{% extends 'main/base.html' %}
{% load static %}
{% block extra_css %}
    <link rel="stylesheet" href="{% static 'challenges/css/challenges.css' %}">
{% endblock %}
{% block extra_js %}
    <script src="{% static 'challenges/js/challenges.js' %}"></script>
{% endblock %}
{% block content %}
    <main class="ch-layout">
        <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">

        <section class="ch-sidebar">
            <div class="ch-card ch-summary">
                <h2 class="ch-title">Your challenge stats</h2>
                <div class="ch-summary-row">
                    <span>Total</span>
                    <span id="stat-total">0</span>
                </div>
                <div class="ch-summary-row">
                    <span>In progress</span>
                    <span id="stat-progress">0</span>
                </div>
                <div class="ch-summary-row">
                    <span>Completed</span>
                    <span id="stat-completed">0</span>
                </div>

                <div class="ch-divider"></div>

                <p class="ch-subtitle">Filter by difficulty</p>
                <div class="ch-filter-group">
                    <button class="ch-filter-btn ch-filter-btn-active" data-filter="all">All</button>
                    <button class="ch-filter-btn" data-filter="easy">Easy</button>
                    <button class="ch-filter-btn" data-filter="medium">Medium</button>
                    <button class="ch-filter-btn" data-filter="hard">Hard</button>
                </div>

                <p class="ch-subtitle">Search</p>
                <div class="ch-search-box">
                    <input type="text" id="challenge-search" placeholder="Search challenge...">
                </div>
            </div>

            <div class="ch-card ch-tip">
                <h3 class="ch-tip-title">Today’s tip</h3>
                <p class="ch-tip-text">
                    Pick one small challenge, finish it fully, and only then switch to the next.
                </p>
            </div>
        </section>

        <section class="ch-main">
            <div class="ch-main-header">
                <div>
                    <h1 class="ch-main-title">Challenges</h1>
                    <p class="ch-main-subtitle">
                        Plan your coding, study and activity challenges in one clean space.
                    </p>
                </div>
                <!-- здесь больше НЕТ Add new challenge -->
            </div>

            <div class="ch-list-header">
                <span>Name</span>
                <span>Difficulty</span>
                <span>Status</span>
                <span>Progress</span>
                <span></span>
            </div>

            <div class="ch-list" id="challenge-list">
                {% for challenge in challenges %}
                    <article class="challenge-card"
                             data-difficulty="{{ challenge.difficulty }}"
                             data-status="{% if challenge.id in completed_ids %}done{% else %}not-started{% endif %}"
                             data-challenge-id="{{ challenge.id }}">
                        <div class="ch-cell ch-cell-name">
                            <h3 class="challenge-title">{{ challenge.title }}</h3>
                            <p class="challenge-desc">{{ challenge.description }}</p>
                            <div class="ch-tags">
                                <span class="ch-tag">{{ challenge.topic }}</span>
                            </div>
                        </div>

                        <div class="ch-cell ch-cell-diff">
                            {% if challenge.difficulty == 'easy' %}
                                <span class="ch-badge ch-badge-easy">{{ challenge.difficulty }}</span>
                                <div class="ch-points">10 pts</div>
                            {% elif challenge.difficulty == 'medium' %}
                                <span class="ch-badge ch-badge-medium">{{ challenge.difficulty }}</span>
                                <div class="ch-points">20 pts</div>
                            {% else %}
                                <span class="ch-badge ch-badge-hard">{{ challenge.difficulty }}</span>
                                <div class="ch-points">30 pts</div>
                            {% endif %}
                        </div>

                        <div class="ch-cell ch-cell-status">
                            {% if challenge.id in completed_ids %}
                                <span class="ch-status-badge ch-status-completed">Completed</span>
                            {% else %}
                                <span class="ch-status-badge ch-status-not-started">Not started</span>
                            {% endif %}
                        </div>

                        <div class="ch-cell ch-cell-progress">
                            <div class="ch-progress">
                                <div class="ch-progress-bar {% if challenge.id in completed_ids %}ch-progress-completed{% endif %}"
                                     style="width: {% if challenge.id in completed_ids %}100%{% else %}0%{% endif %};">
                                </div>
                            </div>
                        </div>

                        <div class="ch-cell ch-cell-action">
                            <button class="ch-secondary-btn status-toggle">
                                {% if challenge.id in completed_ids %}Again{% else %}Start{% endif %}
                            </button>
                        </div>
                    </article>

                {% endfor %}
            </div>
        </section>
    </main>

{% endblock %}


